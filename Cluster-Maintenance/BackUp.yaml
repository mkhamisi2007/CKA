---------------------------Manifests-----------------------------
kubectl get all --all-namespaces -o yaml > resources.yaml
# OR
kubectl get $(kubectl api-resources --namespaced=true -o name) \
  --all-namespaces -o yaml > full-backup.yaml
---------------------------etcd(DataBase)------------------------
kubectl exec -it -n kube-system etcd-k8n-master -- sh
ETCDCTL_API=3 
etcdctl snapshot save /opt/backup/etcd-snapshot.db \
  --endpoints=https://127.0.0.1:2379 \
  --cacert=/etc/kubernetes/pki/etcd/ca.crt \
  --cert=/etc/kubernetes/pki/etcd/server.crt \
  --key=/etc/kubernetes/pki/etcd/server.key
----
ETCDCTL_API=3 
etcdctl snapshot restore etcd-snapshot.db
------------------------Velero----------------------------------
# create IAM User in AWS and create Credential for it(ACCESS_KEY & SECRET_ACCESS) whith the below policy
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "VeleroPermissions",
            "Effect": "Allow",
            "Action": [
                "ec2:DescribeVolumes",
                "ec2:DescribeSnapshots",
                "ec2:CreateTags",
                "ec2:CreateVolume",
                "ec2:CreateSnapshot",
                "ec2:DeleteSnapshot",
                "s3:GetObject",
                "s3:PutObject",
                "s3:DeleteObject",
                "s3:ListBucket"
            ],
            "Resource": "*"
        }
    ]
}
---- create a bucket---
aws s3api create-bucket \
  --bucket velero-uni-backups \
  --region eu-west-1 \
  --create-bucket-configuration LocationConstraint=eu-west-1
---- install velero in kubernetes cluster----
wget https://github.com/vmware-tanzu/velero/releases/download/v1.17.1/velero-v1.17.1-linux-amd64.tar.gz
tar -xvf velero-v1.17.1-linux-amd64.tar.gz
mv velero-v1.17.1-linux-amd64/velero /usr/local/bin/
velero version
---
nano credentials-velero
  [default]
  aws_access_key_id = YOUR_ACCESS_KEY_ID
  aws_secret_access_key = YOUR_SECRET_ACCESS_KEY
----
velero install \
  --provider aws \
  --plugins velero/velero-plugin-for-aws:v1.8.0 \
  --bucket velero-uni-backups \
  --secret-file ./credentials-velero \
  --backup-location-config region=us-east-1,s3ForcePathStyle=true,s3Url=https://s3.us-east-1.amazonaws.com \
  --use-node-agent \
  --default-volumes-to-fs-backup \
  --wait
velero version
  Client:
        Version: v1.17.1
        Git commit: 94f64639cee09c5caaa65b65ab5f42175f41c101
  Server:
        Version: v1.17.1
------- ready to make backup-------------
velero backup-location get
  NAME      PROVIDER   BUCKET/PREFIX             PHASE       LAST VALIDATED                  ACCESS MODE   DEFAULT
  default   aws        velero-uni-backups        Available   2025-12-07 18:02:19 +0100 CET   ReadWrite     true

velero backup create test-backup --include-namespaces default
velero backup get
  NAME          STATUS      ERRORS   WARNINGS   CREATED                         EXPIRES   STORAGE LOCATION   SELECTOR
  test-backup   Completed   0        0          2025-12-07 18:01:15 +0100 CET   29d       default            <none>
velero restore create --from-backup test-backup
velero restore get
---
velero schedule create weekly-backup \
    --schedule="0 2 * * 1" \
    --ttl=720h \
    --include-namespaces="*" \
    --default-volumes-to-fs-backup
velero schedule get
velero schedule delete weekly-backup
------------- unistall velero ----------
velero uninstall











